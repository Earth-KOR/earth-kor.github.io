
<!DOCTYPE html>
<html lang="en">
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="이상권의 개발노트">
    <title>Tag: Spring - 이상권의 개발노트</title>
    <meta name="author" content="이상권">
    
    
    
    <script type="application/ld+json">{}</script>
    <meta property="og:type" content="blog">
<meta property="og:title" content="이상권의 개발노트">
<meta property="og:url" content="https://earth-kor.github.io/tags/Spring/index.html">
<meta property="og:site_name" content="이상권의 개발노트">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="이상권">
<meta name="twitter:card" content="summary">
    
    
        
    
    
        <meta property="og:image" content="https://earth-kor.github.io/assets/images/profile.jpg"/>
    
    
    
    
    <!--STYLES-->
    
<link rel="stylesheet" href="/assets/css/all.css">

    
<link rel="stylesheet" href="/assets/css/jquery.fancybox.css">

    
<link rel="stylesheet" href="/assets/css/thumbs.css">

    
<link rel="stylesheet" href="/assets/css/tranquilpeak.css">

    <!--STYLES END-->
    

    

    
</head>

    <body>
        <div id="blog">
            <!-- Define author's picture -->


    
        
            
        
    

<header id="header" data-behavior="2">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <div class="header-title">
        <a
            class="header-title-link"
            href="/"
            aria-label=""
        >
            이상권의 개발노트
        </a>
    </div>
    
        
            <a
                class="header-right-picture "
                href="#about"
                aria-label="Open the link: /#about"
            >
        
        
            <img class="header-picture" src="/assets/images/profile.jpg" alt="Author&#39;s picture"/>
        
        </a>
    
</header>

            <!-- Define author's picture -->



        
    

<nav id="sidebar" data-behavior="2">
    <div class="sidebar-container">
        
            <div class="sidebar-profile">
                <a
                    href="/#about"
                    aria-label="Read more about the author"
                >
                    <img class="sidebar-profile-picture" src="/assets/images/profile.jpg" alt="Author&#39;s picture"/>
                </a>
                <h4 class="sidebar-profile-name">이상권</h4>
                
                    <h5 class="sidebar-profile-bio"><p>미래의 백엔드 개발자</p>
</h5>
                
            </div>
        
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/index"
                            
                            rel="noopener"
                            title="홈"
                        >
                        <i class="sidebar-button-icon fa fa-home" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">홈</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-categories"
                            
                            rel="noopener"
                            title="카테고리"
                        >
                        <i class="sidebar-button-icon fa fa-code" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">카테고리</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-tags"
                            
                            rel="noopener"
                            title="태그"
                        >
                        <i class="sidebar-button-icon fa fa-tag" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">태그</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-archives"
                            
                            rel="noopener"
                            title="기록"
                        >
                        <i class="sidebar-button-icon fa fa-running" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">기록</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://github.com/Earth-KOR"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="GitHub"
                        >
                        <i class="sidebar-button-icon fab fa-github" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">GitHub</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://www.instagram.com/kwon_27_/?hl=ko"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="instagram"
                        >
                        <i class="sidebar-button-icon fab fa-instagram" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">instagram</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="mailto:lsk941017@naver.com"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="Mail"
                        >
                        <i class="sidebar-button-icon fa fa-envelope" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Mail</span>
                    </a>
            </li>
            
        </ul>
        
    </div>
</nav>

            
            <div id="main" data-behavior="2"
                 class="
                        hasCoverMetaIn
                        ">
                
    <section class="postShorten-group main-content-wrap">
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/2021/03/27/Data%20formatting/"
                            aria-label=": Data formatting"
                        >
                            Data formatting
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2021-03-27T11:44:09-07:00">
	
		    Mar 27, 2021
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/%EA%B0%9C%EB%B0%9C%EB%85%B8%ED%8A%B8/">개발노트</a>, <a class="category-link" href="/categories/%EA%B0%9C%EB%B0%9C%EB%85%B8%ED%8A%B8/Spring/">Spring</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h1 id="데이터를-formatting-하는-방법"><a href="#데이터를-formatting-하는-방법" class="headerlink" title="데이터를 formatting 하는 방법"></a>데이터를 formatting 하는 방법</h1><p>기본적으로 프론트에 reture 하는 값은 Entity 자체를 그대로 리턴하면 안된다.<br>따라서 필요한 데이터만 return 해주기 위해서 새로운 reture DTO를 만들고 보내줘야하는데<br>모든 값들을 해당 DTO로 하나씩 손으로 넣어 주려면 시간이 많이 걸린다.<br>이런 문제를 대비해서 깔끔하게 만들 수 있는 방법은 다음과 같다.</p>
<ol>
<li>Convert</li>
</ol>
<p>1)) 처음에는 @Mapper 가 등록된 하나의 interface를 만들어야 한다.</p>
<p>@Mapper(componentModel = “spring”, unmappedTargetPolicy = ReportingPolicy.IGNORE, imports = {CarManualCarCode.class, Collectors.class})<br>public interface CarManualMapper<br>{<br>}</p>
<p>2)) 들어오는 객체와 바꿀 객체를 정하고 메서드를 만들어 준다.</p>
<p>CarInstallManual convert(CarRequestManualDTO source);</p>
<p>3)) 이렇게만 선언하면 모든 걸 다 바꾸기 때문에 무시할건 무시하고 이름이 맞지 않는건 우리가 커스터마이징이 가능하다.</p>
<p>@Mapping(source = “locationOfFuseBoxType”, target = “locationOfFuseBox”)</p>
<ul>
<li>컬럼명이 다를때</li>
</ul>
<p>@Mapping(target = “carManualCarCodes”, ignore = true)</p>
<ul>
<li>변경하지않을 컬럼을 지정할때</li>
</ul>
<p>@Mapping(expression = “java(source.getCarManualCarCodes().stream().map(CarManualCarCode::getModelCode).collect(Collectors.toList()))”, target = “modelCodes”)</p>
<ul>
<li>Spring이 만든 코드를 쓰지않고 내가 직접 만들고싶을때</li>
</ul>
<p>4)) 이대로 bulid를 하면 자동으로 SetGet코드를 만들어 준다.</p>
<ol start="2">
<li>생성자</li>
</ol>
<p>1)) 하나의 DTO를 만들고 바꾸고 싶은것만 지정해서 생성자를 만들어준다</p>
<p>@AllArgsConstructor<br>@NoArgsConstructor<br>@Data<br>public class CarManualListDTO implements Serializable<br>{</p>
<pre><code>private Long id;
private String pathOfDiagramImage;
private ManualImage manualImage1;
private ManualImage manualImage2;
private String modelSubName;
private String releasedYear;
private FuseType fuseType;
private String manufacturer;
private String note;
private LocationOfFuseBoxType locationOfFuseBoxType;
private NumberOfFuseBoxType numberOfFuseBoxType;
private Boolean isDeleted;
private LocalDateTime lastDeletedDateTime;
private LocalDateTime createdAt;
private List&lt;CarManualCarCode&gt; ModelCodes;
private String pathOfNoteImage;

public CarManualListDTO(CarInstallManual carInstallManual)
&#123;
    this.id = carInstallManual.getId();
    this.pathOfDiagramImage = carInstallManual.getPathOfDiagramImage();
    this.manualImage1 = carInstallManual.getManualImage_1();
    this.manualImage2 = carInstallManual.getManualImage_2();
    this.modelSubName = carInstallManual.getModelSubName();
    this.releasedYear = carInstallManual.getReleasedYear();
    this.fuseType = carInstallManual.getFuseType();
    this.manufacturer = carInstallManual.getManufacturer();
    this.note = carInstallManual.getNote();
    this.locationOfFuseBoxType = carInstallManual.getLocationOfFuseBox();
    this.numberOfFuseBoxType = carInstallManual.getNumberOfFuseBox();
    this.isDeleted = carInstallManual.getIsDeleted();
    this.lastDeletedDateTime = carInstallManual.getLastDeletedDateTime();
    this.createdAt = carInstallManual.getCreatedAt();
    this.pathOfNoteImage = carInstallManual.getPathOfNoteImage();
    this.ModelCodes = checkIsDeletedCarCode(carInstallManual.getCarManualCarCodes());
&#125;</code></pre>
<p>2)) 생성자를 넣을 때 조건문을 넣고 싶다면 하나의 새로운 메서드를 생성하고 거기다가 조건을 적어주면 된다!</p>
<p>private List<CarManualCarCode> checkIsDeletedCarCode(List<CarManualCarCode> carCodes)<br>{<br>    return carCodes.stream().filter((i) -&gt; i.getIsDeleted() == false).collect(Collectors.toList());<br>}<br>}</p>

                    
                        


                    
                    
                        <p>
                            <a
                                href="/2021/03/27/Data%20formatting/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/2021/03/27/Dirty%20checking/"
                            aria-label=": Dirty checking"
                        >
                            Dirty checking
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2021-03-27T11:44:09-07:00">
	
		    Mar 27, 2021
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/%EC%9D%B4%EB%A1%A0%EB%85%B8%ED%8A%B8/">이론노트</a>, <a class="category-link" href="/categories/%EC%9D%B4%EB%A1%A0%EB%85%B8%ED%8A%B8/Spring/">Spring</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h1 id="Dirty-checking"><a href="#Dirty-checking" class="headerlink" title="Dirty checking"></a>Dirty checking</h1><p>Dirty란 상태의 변화가 생긴 정도<br>Dirty Checking이란 상태 변경 검사</p>
<p>JPA에서는 트랜잭션이 끝나는 시점에 변화가 있는 모든 엔티티 객체를 데이터 베이스에 자동으로 반영해준 다.</p>
<p>이떄 변화가 있다의 기준은 최초 조회 상태입니다.</p>
<p>당연히 이런 상태 변경 검사의 대상은 영속성 컨텍스트가 관리하는 엔티티에만적용 됩니다.</p>
<ul>
<li>detach된 엔티티 (준영속)</li>
<li>DB에 반영되기 전 처음 생성된 엔티티 (비영속)<br>등 준영속/비영속 상태의 엔티티는 Dirty Checking 대상에 포함되지 않습니다.즉, 값을 변경해도 데이터베이스에 반영되지 않는다는 것이죠.</li>
</ul>
<h2 id="변경-부분만-update하고-싶을-땐"><a href="#변경-부분만-update하고-싶을-땐" class="headerlink" title="변경 부분만 update하고 싶을 땐?"></a>변경 부분만 update하고 싶을 땐?</h2><p>JPA에서는 전체 필드를 업데이트하는 방식을 기본값으로 사용합니다.전체 필드를 업데이트하는 방식의 장점은 다음과 같습니다.</p>
<ul>
<li>생성되는 쿼리가 같아 부트 실행시점에 미리 만들어서 재사용가능합니다.</li>
<li>데이터베이스 입장에서 쿼리 재사용이 가능하다<ul>
<li>동일한 쿼리를 받으면 이전에 파싱된 쿼리를 재사용한다.</li>
</ul>
</li>
</ul>
<p>그래서 이런 경우엔 @DynamicUpdate로 변경 필드만 반영되도록 할 수 있습니다.<br>엔티티 최상단에 아래와 같이 @DynamicUpdate 를 선언해주시면 됩니다.</p>

                    
                        


                    
                    
                        <p>
                            <a
                                href="/2021/03/27/Dirty%20checking/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/2021/03/27/Lazy%20vs%20Eager/"
                            aria-label=": Lazy vs Eager"
                        >
                            Lazy vs Eager
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2021-03-27T11:44:09-07:00">
	
		    Mar 27, 2021
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/%EC%9D%B4%EB%A1%A0%EB%85%B8%ED%8A%B8/">이론노트</a>, <a class="category-link" href="/categories/%EC%9D%B4%EB%A1%A0%EB%85%B8%ED%8A%B8/Spring/">Spring</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h1 id="LAZY-EAGER"><a href="#LAZY-EAGER" class="headerlink" title="LAZY , EAGER"></a>LAZY , EAGER</h1><p>@ManyToOne  or  @OneToMany 형태로 설계되어 있다면 다음과 같은 형태로 데이터를 가져올 수 있다.</p>
<ol>
<li>지연로딩 (LAZY)</li>
</ol>
<ul>
<li>로딩되는 시점에 Lazy 로딩 설정이 되어있는 Team 엔티티는 프록시 객체로 가져온다</li>
<li>후에 실제 객체를 사용하는 시점에 초기화가 된다. 이때 DB에 쿼리가 나간다</li>
<li>이런 경우 SELECT 쿼리가 따로따로 2번 나간다.</li>
<li>만약, 바로 두 테이블의 데이터가 필요하다면 EAGER를 사용하면 된다.</li>
</ul>
<ol start="2">
<li>즉시로딩 (EAGER)</li>
</ol>
<ul>
<li>대부분의 JPA 구현체는 가능하면 조인을 사용하서 SQL 한번에 조회하려고 한다.</li>
<li>이렇게 하면 실제 조회 할 떄 한방 쿼리로 다 조회 해온다.</li>
<li>이때는 프록시 객체가 아니라 실제 객체를 가져온다.</li>
</ul>

                    
                        


                    
                    
                        <p>
                            <a
                                href="/2021/03/27/Lazy%20vs%20Eager/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/2021/03/27/%EC%98%81%EC%86%8D%EC%84%B1%20%EC%BB%A8%ED%85%8D%EC%8A%A4%ED%8A%B8/"
                            aria-label=": 영속성 컨텍스트"
                        >
                            영속성 컨텍스트
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2021-03-27T11:44:09-07:00">
	
		    Mar 27, 2021
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/%EA%B0%9C%EB%B0%9C%EB%85%B8%ED%8A%B8/">개발노트</a>, <a class="category-link" href="/categories/%EA%B0%9C%EB%B0%9C%EB%85%B8%ED%8A%B8/Spring/">Spring</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h1 id="영속성-컨텍스트"><a href="#영속성-컨텍스트" class="headerlink" title="영속성 컨텍스트"></a>영속성 컨텍스트</h1><p>엔티티 매니저를 통해 엔티티를 저장하거나 조회하면 엔티티 매니저는 영속성 컨텍스트에 엔티티를 보관하고 관리한다. </p>
<p>entityManager.persist ( [entityName] )</p>
<ul>
<li>엔티티 매니저를 사용해 회원 엔티티를 영속성 컨텍스트에 저장 한다는 의미</li>
</ul>
<h2 id="영속성-컨텍스트의-특징"><a href="#영속성-컨텍스트의-특징" class="headerlink" title="영속성 컨텍스트의 특징"></a>영속성 컨텍스트의 특징</h2><ol>
<li>엔티티 매니저를 생성 할 때 하나 만들어진다.</li>
<li>엔티티 매니저를 통해서 영속성 컨텍스트에 접근하고 관리 할 수 있다.</li>
</ol>
<h2 id="엔티티의-생명주기"><a href="#엔티티의-생명주기" class="headerlink" title="엔티티의 생명주기"></a>엔티티의 생명주기</h2><ol>
<li>비영속 : 영속성 컨텍스트와 전혀 관계가 없는 상태</li>
<li>영속. : 영속성 컨텍스트에 저장된 상태</li>
<li>준영속 : 영속성 컨텍스트에 저장되었다고 분리된 상태</li>
<li>삭제 : 삭제된 상태</li>
</ol>
<h2 id="영속성-컨텍스트의-특징-1"><a href="#영속성-컨텍스트의-특징-1" class="headerlink" title="영속성 컨텍스트의 특징"></a>영속성 컨텍스트의 특징</h2><ol>
<li>영속성 컨텍스트의 식별자 값</li>
</ol>
<ul>
<li>영속성 컨텍스트는 엔티티를 식별자 값으로 구분한다. 따라서 영속 상태는 식별자 값이 반드시 있어야 한다.</li>
</ul>
<ol start="2">
<li>영속성 컨텍스트와 데이터베이스 저장</li>
</ol>
<ul>
<li>JPA는 보통 트랜잭션을 커밋하는 순간 영속성 컨텍스트에 새로 저장된 엔티티를 데이터 베이스에 반영하는데 이를 flush 라고 한다.</li>
</ul>
<h2 id="영속성-컨텍스트가-엔티티를-관리하는-다음과-같은-장점이-있다"><a href="#영속성-컨텍스트가-엔티티를-관리하는-다음과-같은-장점이-있다" class="headerlink" title="영속성 컨텍스트가 엔티티를 관리하는 다음과 같은 장점이 있다."></a>영속성 컨텍스트가 엔티티를 관리하는 다음과 같은 장점이 있다.</h2><ol>
<li>1차 캐시</li>
</ol>
<ul>
<li>영속성 컨텍스트  내부에는 캐시가 있는데 이를 1차 캐시라고 한다. 영속 상태의 엔티티를 이곳에 저장한다. 1차 캐시의 키는 식별자 값이고 값은 엔티티 인스터스이다.</li>
</ul>
<ol start="2">
<li>동일성 보장</li>
</ol>
<ul>
<li>영속성 컨텍스트는 엔티티의 동일성을 보장한다.</li>
</ul>
<p>Member a = em.find(Member.class, “member1”);<br>Member b = em.find(Member.class, “member1”);<br>System.out.print(a==b) // true</p>
<p>실제 인스턴스는 다를 수 있지만 인스턴스가 가지고 있는 값은 같다.</p>
<ol start="3">
<li>트랙잭션을 지원하는 쓰기 지연</li>
</ol>
<p>엔티티 매니저는 트랜잭션을 커밋하기 직전까지 내부 쿼리 저장소에 INSERT SQL을 모아둔다. 그리고 트랜잭션을 커밋할 때 모아둔 쿼리를 DB에 보낸다. 이것을 트랜잭션을 지원하는 쓰기 지연이라 한다.</p>
<h2 id="변경감지"><a href="#변경감지" class="headerlink" title="변경감지"></a>변경감지</h2><ol>
<li><p>트랙잭션을 커밋하면 엔티티 매니저 내부에서 먼저 플러시가 호출된다.</p>
</li>
<li><p>엔티티와 스냅샷을 비교하여 변경된 엔티티를 찾는다.</p>
</li>
<li><p>변경된 엔티티가 있으면 수정 쿼리를 생성해서 쓰기 지연 SQL 저장소에 저장한다.</p>
</li>
<li><p>쓰기 지연 저장소의 SQL을 플러시한다.</p>
</li>
<li><p>데이터베이스 트랜잭션을 커밋한다.</p>
</li>
</ol>
<h2 id="플러시"><a href="#플러시" class="headerlink" title="플러시"></a>플러시</h2><p>플러시는 영속성 컨텍스트의 변경 내용을 데이터베이스에 반영한다. 영속성 컨텍스트의 엔티티를 지우는게 아니라 변경 내용을 데이터베이스에 동기화하는 것이다.</p>
<p>플러시의 흐름</p>
<ol>
<li>변경 감지가 동작해서 스냅샷과 비교해서 수정된 엔티티를 찾는다.</li>
<li>수정된 엔티티에 대해서 수정 쿼리를 만들거 SQL 저장소에 등록한다.</li>
<li>쓰기 지연 SQL 저장소의 쿼리를 데이터베이스에 전송한다.</li>
</ol>
<p>플러시하는 방법<br>1. em.flush()2. 트랙잭션 커밋시 자동 호출3. JPQL 쿼리 실행시 자동 호출</p>

                    
                        


                    
                    
                        <p>
                            <a
                                href="/2021/03/27/%EC%98%81%EC%86%8D%EC%84%B1%20%EC%BB%A8%ED%85%8D%EC%8A%A4%ED%8A%B8/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/2021/03/27/%EC%88%9C%ED%99%98%EC%B0%B8%EC%A1%B0/"
                            aria-label=": 순환참조"
                        >
                            순환참조
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2021-03-27T11:44:09-07:00">
	
		    Mar 27, 2021
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/%EA%B0%9C%EB%B0%9C%EB%85%B8%ED%8A%B8/">개발노트</a>, <a class="category-link" href="/categories/%EA%B0%9C%EB%B0%9C%EB%85%B8%ED%8A%B8/Spring/">Spring</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h1 id="순환참조"><a href="#순환참조" class="headerlink" title="순환참조"></a>순환참조</h1><p>여러 Entity를 만들고 양방향 맵핑을 해준다. 이럴 경우 하나의 Row만을 원해서 쿼리문을 날리면 서로가 서로를 맵핑하며 호출하게 되고 똑같은 데이터가 반복적으로 출력되는 상황이 발생한다!<br>(@ManyToOne , @OneToMany 선어 시)</p>
<p>JPA는 디폴트로 맵핑된 데이터에 대해 FetchType.LAZY를 사용한다.<br>LAZY는 데이터를 한번에 가져오는게 아니라 나중에 가져오는거기 때문에<br>나중에 자식 엔티티를 들여다 보게 되고 이것이 반복되면서 순환참조가 일어난다!</p>
<h2 id="해결방법"><a href="#해결방법" class="headerlink" title="해결방법"></a>해결방법</h2><ol>
<li><p>@JsonIgnore :  이 어노테이션을 붙이면 json 데이터에 해당 프로퍼티는 null로 들어가게 된다. 즉, 데이터에 아예 포함이 안되게 된다.</p>
</li>
<li><p>@JsonManagerdReferernce, @JsonBackRefernce : 부모 클래스에  @JsonManagerdReferernce 자식 클래스에 @JsonBackRefernce를 선언해주면 양방향 맵핑을 예방 할 수 있다.</p>
</li>
<li><p>DTO 사용 : 위와 같은 상황이 발생하게 되면 주 원인은 양방향 맵핑이기도 하지만 더 정확 하게는 entity 자체를 resposnse로 리턴한데에 있다. Entity 자체를 return 하지 말고, dto객체를 만들어 필요한 데이터만 옮겨 담아 client로 리턴하면 순환참조와 관련된 문제를 방어 할 수 있다.</p>
</li>
</ol>
<p> 정리를 하자면 json serialize 과정에서 null로 세팅하고자 하면 @JsonIgnore 사용하면 되고, 순환참조에 대한 문제를 해결하고자 한다면 부모 클래스측에 @JsonManagedReference를, 자식측에 @JsonBackReference를 Annotation에 추가해주면 된다.</p>

                    
                        


                    
                    
                        <p>
                            <a
                                href="/2021/03/27/%EC%88%9C%ED%99%98%EC%B0%B8%EC%A1%B0/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    <div class="pagination-bar">
    <ul class="pagination">
        
        
        <li class="pagination-number">page 1 of 1</li>
    </ul>
</div>

</section>


                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2021 이상권. All Rights Reserved.
    </span>
</footer>

            </div>
            
        </div>
        


    
        
    

<div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-times"></i>
        </div>
        
            <img id="about-card-picture" src="/assets/images/profile.jpg" alt="Author&#39;s picture"/>
        
            <h4 id="about-card-name">이상권</h4>
        
            <div id="about-card-bio"><p>미래의 백엔드 개발자</p>
</div>
        
        
            <div id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br/>
                <p>개발자</p>

            </div>
        
        
            <div id="about-card-location">
                <i class="fa fa-map-marker-alt"></i>
                <br/>
                Busan
            </div>
        
    </div>
</div>

        
        
<div id="cover" style="background-image:url('/assets/images/cover2.png');"></div>
        <!--SCRIPTS-->

<script src="/assets/js/jquery.js"></script>


<script src="/assets/js/jquery.fancybox.js"></script>


<script src="/assets/js/thumbs.js"></script>


<script src="/assets/js/tranquilpeak.js"></script>

<!--SCRIPTS END-->





    </body>
</html>
